<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/white.css">
    <link rel="stylesheet" href="lib/css/zenburn.css">
    <link rel="stylesheet" href="css/custom.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <h2>Data Driven Documents: Data visualization using D3.js</h2>
            <img class="center" height="200" src="img/d3.png">
            <br><br><br>
            Sandro Bauer, Lin Ji, Daniel Schubert, Simon Zachau
        </section>
        <section>
            <h2>Structure</h2>
            <ul>
                <li>Definition</li>
                <li>Reasons for why we should use it</li>
                <li>Instruction on how to use it</li>
                <li>Look & feel</li>
                <li>Alternatives</li>
                <ul>
                    <li>Chart.js</li>
                    <li>Raphael.js</li>
                    <li>nvd3.js</li>
                </ul>
            </ul>
        </section>
        <section id="definition">
            <h2>Definition</h2>
            <ul>
                <li><strong class="highlight">D3</strong>: <strong class="highlight">D</strong>ata-<strong class="highlight">D</strong>riven <strong class="highlight">D</strong>ocuments</li>
                <li>JavaScript library ...</li>
                <li>... for manipulating documents based on data</li>
                <li>Works on SVG/HTML <span class="fragment red">&rarr; no charting library!</span></li>
                <li>Successor to Protovis</li>
            </ul>
        </section>
        <section id="reasons">
            <h2>Reasons for why we should use it</h2>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
        </section>
        <section id="instruction">
            <h2>Instruction on how to use it</h2>
            <section id="svgbasics">
                <h3>SVG</h3>
                <div class="left">
                    <pre><code class="html hljs" data-trim>
                        <svg width="360" height="300">
                            <circle cx="80" cy="150" r="40" fill="red"></circle>
                            <circle cx="180" cy="150" r="20"  fill="blue"></circle>
                            <rect x="255" y="110" width="50" height="80"></rect>
                        </svg>
                    </code></pre>
                </div>
                <div class="right">
                    <svg width="360" height="300">
                        <circle cx="80" cy="150" r="40" fill="red"></circle>
                        <circle cx="180" cy="150" r="20"  fill="blue"></circle>
                        <rect x="255" y="110" width="50" height="80"></rect>
                    </svg>
                </div>
            </section>
            <section id="canvas">
                <h3>SVG with D3</h3>
                <div class="left">
                    <pre><code class="html hljs" data-trim>
                        <svg class="canvas"></svg>
                    </code></pre>
                    <pre><code class="javascript hljs" data-trim>
                        var svg = d3.selectAll(".canvas")
                            .attr("width", "360")
                            .attr("height", "300");
                    </code></pre>
                </div>
                <div class="right">
                    <svg class="canvas"></svg>
                </div>
            </section>
            <section id="rect">
                <h3>Rect</h3>
                <div class="left">
                    <pre><code class="html hljs" data-trim>
                        <svg class="canvas"></svg>
                    </code></pre>
                    <pre><code class="javascript hljs" data-trim>
                        svg.append("rect")
                            .attr("x", "255")
                            .attr("y", "110")
                            .attr("width", "50")
                            .attr("height", "80");
                    </code></pre>
                </div>
                <div class="right">
                    <svg class="canvas"></svg>
                </div>
            </section>
            <section id="circle">
                <h3>Circle</h3>
                <div class="left">
                    <pre><code class="html hljs" data-trim>
                        <svg class="canvas"></svg>
                    </code></pre>
                    <!-- contenteditable in code, if you want it to run -->
                    <pre><code class="javascript hljs" data-trim>
                        var circle = svg.selectAll("circle").data([40, 20]);
                        circle.enter().append("circle")
                            .attr("cy", 150)
                            .attr("cx", function(d,i) {return 80 + i * 100})
                            .attr('r', function(d) { return d; });
                    </code></pre>
                </div>
                <div class="right">
                    <svg class="canvas"></svg>
                </div>
                <aside class="notes">
                    Binding macht irgendwas
                </aside>
                <!--button>Run</button-->
            </section>
            <section>
                <h3>Other stuff</h3>
                TODO: scale, attr, axis, transitions
            </section>
            <section id="events">
                <h3>Events</h3>
                <div class="left">
                    <pre><code class="html hljs" data-trim>
                        <svg class="canvas"></svg>
                    </code></pre>
                    <pre><code class="javascript hljs" data-trim>
                        svg.on("mouseover", function(d, index, array){
                            svg.selectAll("circle").transition().duration(500)
                                .attr("cy", 100);
                        }).on("mouseout", function(d) {
                            svg.selectAll("circle").transition().duration(500)
                                .attr("cy", 150);
                        });
                    </code></pre>
                </div>
                <div class="right">
                    <svg class="canvas"></svg>
                </div>
            </section>
        </section>
        <section id="lookandfeel">
            <h2>Look & feel</h2>
            <section>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
            </section>
        </section>
        <section id="alternatives">
            <h2>Alternatives</h2>
            <section id="chartjs">
                <h3>Chart.js</h3>
                <ul>
                    <li>Easy, object oriented client side graphs for designers and developers</li>
                    <li>6 chart types</li>
                </ul>
            </section>
            <section id="raphaeljs">
                <h3>Raphaël.js <img height="50" src="img/raphael.png"></h3>
                <ul>
                    <li>Also uses SVG for rendering</li>
                    <li>Provides abstraction layer for browsers which do not support SVG</li>
                    <li>Uses VML for older IE</li>
                </ul>
                <div class="left">
                    <pre><code class="javascript hljs" data-trim>
                        // Creates canvas 320 × 200 at raphaelCircle
                        var paper = Raphael("raphaelCircle", 320, 200);

                        // Creates circle at x = 50, y = 40, with radius 10
                        var circle = paper.circle(50, 40, 20);
                        // Sets the fill attribute of the circle to red (#f00)
                        circle.attr("fill", "#f00");
                        // Sets the stroke attribute of the circle to white
                        circle.attr("stroke", "#fff");
                    </code></pre>
                </div>
                <div class="right">
                    <div id="raphaelCircle"></div>
                </div>
            </section>
            <section id="nvd3js">
                <h3>nvd3.js</h3>
                <ul>
                    <li>Building re-usable charts and chart components</li>
                    <li>Based on D3.js</li>
                </ul>
            </section>
            <section id="alternativesummary">
                <svg class="alternativepics"></svg>
                <!--div>
                    <img height="200" src="img/raphael.png">
                    <img height="200" src="img/chartjs.svg">
                    <img height="200" src="img/anychart.png">
                    <img height="69" src="img/pixijs.png">
                <ul>
                    <li>Google Charts</li>
                    <li>paper.js</li>
                    <li>Fabric.js</li>
                </ul><br>
                <p>
                    Based on d3.js<br>
                </p>
                <ul>
                    <li>C3.js</li>
                    <li>nvd3.js</li>
                </ul>
                </div-->
            </section>
        </section>
    </div>
</div>
<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>
<script src="js/d3.min.js"></script>
<script src="js/raphael.min.js"></script>
<script src="js/chart.min.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>
    // Reveal.js Code

    // More info https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: false,
        width: "1280",
        height: "720",
        //margin: 0,

        transition: 'fade', // none/fade/slide/convex/concave/zoom

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
            { src: 'plugin/markdown/marked.js' },
            { src: 'plugin/markdown/markdown.js' },
            { src: 'plugin/notes/notes.js', async: true },
            { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
    });

    /*var svg = d3.select("#circle");
    var circle = svg.select("svg").data([1000]);
    circle.enter().append("circle")
        .attr("cy", 0)
        .attr("cx", 0)
        .attr('r', function(d) { return Math.sqrt(d); });*/
//    circle.transition()
//        .attr("r", function(d) { return Math.sqrt(d); });
    //circle.exit().transition()
     //   .attr('r', 0)
     //   .remove();
</script>
<script type="text/javascript">
    // D3.js Code

    // does not work yet, no idea why
    var svg = d3.selectAll(".canvas")
        .attr("width", "360")
        .attr("height", "300");
    Reveal.addEventListener( 'slidechanged', function( event ) {
        // event.previousSlide, event.currentSlide, event.indexh, event.indexv
        svg.on("mouseover", null);
        svg.on("mouseout", null);
        svg.selectAll("circle").remove();
        svg.selectAll("rect").remove();
        if (event.currentSlide == null) {
            return;
        }
        switch(event.currentSlide.id) {
            case "events":
                svg.on("mouseover", function(d, index, array){
                    svg.selectAll("circle").transition().duration(500)
                        .attr("cy", 100);
                }).on("mouseout", function(d) {
                    svg.selectAll("circle").transition().duration(500)
                        .attr("cy", 150);
                });
            case "circle":
                var circle = svg.selectAll("circle").data([40, 20]);
                circle.enter().append("circle")
                    .attr("cy", 150)
                    .attr("cx", function(d,i) {return 80 + i * 100})
                    .attr('r', function(d) { return d; });
            //.attr("fill", "#f00");
            case "rect":
                svg.append("rect")
                    .attr("x", "255")
                    .attr("y", "110")
                    .attr("width", "50")
                    .attr("height", "80");
                break;
        }
    } );

    var alternativesWidth = 1280,
        alternativesHeight = 500;
    var alternativeSVG = d3.select(".alternativepics")
        .attr("width", alternativesWidth)
        .attr("height", alternativesHeight),
        g = alternativeSVG.append("g").attr("transform", "translate(2,2)"),
        format = d3.format(",d");

    var pack = d3.pack()
        .size([alternativesWidth - 4, alternativesHeight - 4]);

    d3.json("alternatives.json", function(error, root) {
        if (error) throw error;

        root = d3.hierarchy(root)
            .sum(function(d) { return 1; });
//            .sort(function(a, b) { return b.value - a.value; });

        var node = g.selectAll(".node")
            .data(pack(root).leaves());
        var nodeEnter = node.enter().append("g")
            .attr("class", function(d) { return d.children ? "node" : "leaf node"; })
            .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

        // background circles
        var circ = nodeEnter.append("circle")
            .attr("r", function(d) { return d.r; })
            .attr("fill", "#0003");

        // text
        nodeEnter.filter(function(d) { return !d.children && !d.data.img; })
            .append("text")
            .attr("dy", "0.3em")
            .html(function(d) {
                var splitted = d.data.name.split(" ");
                var ret = "";
                var i = 0;
                if (splitted.length == 2) {
                    splitted.forEach(function(entry) {
                        ret += "<tspan x='0' dy='"+ i + "em'>" + entry + "</tspan>";
                        i++;
                    });
                } else {
                    ret = splitted[0];
                }
                return ret;
            });
            //.html(function(d) { return "<tspan>" d.data.name; "</tspan>" });

        // images
        nodeEnter.filter(function(d) { return !d.children; })
            .append("svg:image")
            .attr("xlink:href",  function(d) { return d.data.img;})
            .attr("x", function(d) { return -circ.attr("r") * .8; })
            .attr("y", function(d) { return -circ.attr("r") * .8; })
            //.attr("y", function(d,i) { return -25;})
            .attr("height", function(d) { return circ.attr("r") * 1.6; })
            .attr("width", function(d) { return circ.attr("r") * 1.6; });
    });

    /*var format = d3.format(",d");
    var pack = d3.pack()
        .size([1280, 500])
        .padding(1.5);

    //var force = d3.layout.force();
    var alternativeSVG = d3.select(".alternativepics")
        .attr("width", "1280")
        .attr("height", "500")
        .attr("class", "bubble");
    // Update the nodes…
    var node = alternativeSVG.selectAll("g.node")
        .data(pack([
            "img/raphael.png",
            "img/chartjs.svg",
            "img/anychart.png",
            "img/pixijs.png"
        ]).descendants());
    // Enter any new nodes.
    var nodeEnter = node.enter().append("svg:g")
        .attr("class", "node")
        //.call(force.drag);
        .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

    node.append("title")
        .text(function(d) { return format(d.value); });

    // Append a circle
    node.append("svg:circle")
        .attr("r", function(d) { return d.r; })
        //.attr("cx", function(d,i) { return 30 + i * 50})
        //.attr("cy", "100")
        .style("fill", "#eee");

    node.append("text")
        .attr("dy", ".3em")
        .style("text-anchor", "middle")
        .text(function(d) { return d; });*/

    // Append images
    /*var images = nodeEnter.append("svg:image")
        .attr("xlink:href",  function(d) { return d;})
        //.attr("x", function(d,i) { return 30 + i * 50 -25;})
        //.attr("y", function(d,i) { return 30 + i * 50 -25;})
        //.attr("y", function(d,i) { return -25;})
        .attr("height", 100)
        .attr("width", 100);*/

</script>
<script>
    // Raphael.js Code

    // Creates canvas 320 × 200 at raphaelCircle
    var rPaper = Raphael("raphaelCircle", 320, 200);

    // Creates circle at x = 50, y = 40, with radius 10
    var rCircle = rPaper.circle(50, 40, 20);
    // Sets the fill attribute of the circle to red (#f00)
    rCircle.attr("fill", "#f00");

    // Sets the stroke attribute of the circle to white
    rCircle.attr("stroke", "#00f");
</script>
</body>
</html>